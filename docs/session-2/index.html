<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session 2: Building Approval Workflows | Power Automate Academy</title>
    <link rel="stylesheet" href="../assets/css/styles.css?v=5">
    <link rel="stylesheet" href="assets/cheatsheet.css?v=5">
</head>
<body>
    <header class="hero">
        <div class="container">
            <div class="logo">
                <img src="../img/amadeus_blue_logo.png" alt="Amadeus" height="32">
            </div>
            <nav>
                <a href="../">← Back to Home</a>
                <a href="#prerequisites">Prerequisites</a>
                <a href="#overview">Overview</a>
                <a href="#steps">Steps</a>
                <a href="#troubleshooting">Troubleshooting</a>
            </nav>
        </div>
    </header>

    <!-- Table of Contents -->
    <nav class="toc-sidebar" id="tocSidebar">
        <div class="toc-content">
            <h3 class="toc-title">Contents</h3>
            <ul class="toc-list">
                <li><a href="#prerequisites" class="toc-link" data-section="prerequisites">Prerequisites</a></li>
                <li><a href="#overview" class="toc-link" data-section="overview">Workflow Overview</a></li>
                <li>
                    <a href="#steps" class="toc-link" data-section="steps">Build Instructions</a>
                    <ul class="toc-sublist">
                        <li><a href="#part-1" class="toc-link toc-sublink" data-section="part-1">Step 1: Create Flow</a></li>
                        <li><a href="#part-2" class="toc-link toc-sublink" data-section="part-2">Step 2: Initialize Variables</a></li>
                        <li><a href="#part-3" class="toc-link toc-sublink" data-section="part-3">Step 3: Add Condition</a></li>
                        <li><a href="#part-4" class="toc-link toc-sublink" data-section="part-4">Step 4: Start Approval</a></li>
                        <li><a href="#part-5" class="toc-link toc-sublink" data-section="part-5">Step 5: Check Response</a></li>
                        <li><a href="#part-6" class="toc-link toc-sublink" data-section="part-6">Step 6: Update SharePoint</a></li>
                        <li><a href="#part-7" class="toc-link toc-sublink" data-section="part-7">Step 7: Send Emails</a></li>
                        <li><a href="#part-8" class="toc-link toc-sublink" data-section="part-8">Step 8: Test Flow</a></li>
                    </ul>
                </li>
                <li><a href="#troubleshooting" class="toc-link" data-section="troubleshooting">Troubleshooting</a></li>
            </ul>
        </div>
    </nav>

    <section class="hero-content session-hero">
        <div class="container">
            <div class="session-badge">Session 02</div>
            <div class="hero-logo">
                <img src="assets/images/coe_white_logo.png" alt="CoE Power Platform" width="120">
            </div>
            <h1>Building Approval Workflows</h1>
            <p class="subtitle">RMC Rebate Approval System - Step by Step Guide</p>
            <div class="session-info">
                <span><img src="assets/icons/Clock.svg" width="16" height="16" style="vertical-align: middle; margin-right: 4px;"> Duration: 60 minutes</span>
                <span><img src="assets/icons/Chart.svg" width="16" height="16" style="vertical-align: middle; margin-right: 4px;"> Level: Intermediate</span>
                <span><img src="assets/icons/Settings.svg" width="16" height="16" style="vertical-align: middle; margin-right: 4px;"> Hands-On Workshop</span>
            </div>
        </div>
    </section>

    <section id="prerequisites" class="section">
        <div class="container">
            <h2>Prerequisites</h2>
            <p class="prerequisites-intro">Before starting this hands-on session, make sure you have the following access and knowledge. This will ensure you can follow along smoothly and get the most out of the workshop.</p>

            <div class="prerequisites-grid">
                <div class="prerequisite-card">
                    <div class="prerequisite-header">
                        <img src="assets/icons/Approved.svg" width="24" height="24" class="prerequisite-icon">
                        <h3>Required Access</h3>
                    </div>
                    <div class="prerequisite-content">
                        <a href="https://make.powerautomate.com" target="_blank" class="checklist-item checklist-link">
                            <input type="checkbox" onclick="event.stopPropagation();">
                            <span>Access to Power Automate</span>
                            <img src="assets/icons/External Link.svg" width="16" height="16" class="link-icon">
                        </a>
                        <a href="https://amadeusworkplace.sharepoint.com/sites/CornerOfExcellence/Lists/COE_Academy_PA_Workshop/AllItems.aspx" target="_blank" class="checklist-item checklist-link">
                            <input type="checkbox" onclick="event.stopPropagation();">
                            <span>SharePoint list: <code>COE_Academy_PA_Workshop</code></span>
                            <img src="assets/icons/External Link.svg" width="16" height="16" class="link-icon">
                        </a>
                    </div>
                </div>

                <div class="prerequisite-card">
                    <div class="prerequisite-header">
                        <img src="assets/icons/Light Bulb.svg" width="24" height="24" class="prerequisite-icon">
                        <h3>Basic Knowledge</h3>
                    </div>
                    <div class="prerequisite-content">
                        <ul class="prerequisite-list">
                            <li>Completed Session 1 or familiar with Power Automate basics</li>
                            <li>Understanding of triggers and actions</li>
                            <li>Basic knowledge of SharePoint lists</li>
                        </ul>
                    </div>
                </div>

                <div class="prerequisite-card">
                    <div class="prerequisite-header">
                        <img src="assets/icons/Settings.svg" width="24" height="24" class="prerequisite-icon">
                        <h3>What You'll Need</h3>
                    </div>
                    <div class="prerequisite-content">
                        <ul class="prerequisite-list">
                            <li>Laptop with internet connection</li>
                            <li>Browser: Microsoft Edge or Chrome (recommended)</li>
                            <li>Notepad or note-taking app for reference</li>
                        </ul>
                    </div>
                </div>

                <div class="prerequisite-card">
                    <div class="prerequisite-header">
                        <img src="assets/icons/Clock.svg" width="24" height="24" class="prerequisite-icon">
                        <h3>Time Commitment</h3>
                    </div>
                    <div class="prerequisite-content">
                        <ul class="prerequisite-list">
                            <li>Workshop duration: 60 minutes</li>
                            <li>Hands-on building: ~40 minutes</li>
                            <li>Q&A and troubleshooting: ~20 minutes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="overview" class="section overview-section">
        <div class="container">
            <h2>Workflow Overview</h2>
            <p class="section-subtitle">This is what we'll build together</p>
            <div class="workflow-diagram">
                <div class="workflow-step">
                    <div class="step-icon trigger"><img src="assets/icons/Play Circle.svg" width="32" height="32"></div>
                    <div class="step-content">
                        <h3>Trigger</h3>
                        <p>New item in SharePoint</p>
                    </div>
                </div>
                <div class="workflow-arrow">↓</div>
                <div class="workflow-step">
                    <div class="step-icon"><img src="assets/icons/Box 1.svg" width="32" height="32"></div>
                    <div class="step-content">
                        <h3>Initialize Variables</h3>
                        <p>Amount, Partner, Email, ID</p>
                    </div>
                </div>
                <div class="workflow-arrow">↓</div>
                <div class="workflow-step">
                    <div class="step-icon"><img src="assets/icons/Settings.svg" width="32" height="32"></div>
                    <div class="step-content">
                        <h3>Condition</h3>
                        <p>Requires approval?</p>
                    </div>
                </div>
                <div class="workflow-branches workflow-branches-triple">
                    <div class="branch branch-approval">
                        <div class="branch-label">REQUIRES APPROVAL</div>
                        <div class="workflow-arrow">↓</div>
                        <div class="workflow-step">
                            <div class="step-icon"><img src="assets/icons/Warning.svg" width="28" height="28"></div>
                            <div class="step-content">
                                <h3>Start Approval</h3>
                                <p>Wait for decision</p>
                            </div>
                        </div>
                        <div class="workflow-arrow">↓</div>
                        <div class="workflow-step">
                            <div class="step-icon"><img src="assets/icons/Settings.svg" width="28" height="28"></div>
                            <div class="step-content">
                                <h3>Check Response</h3>
                                <p>Approved or Rejected?</p>
                            </div>
                        </div>
                        <div class="workflow-subbranches">
                            <div class="subbranch">
                                <div class="subbranch-label">APPROVED</div>
                                <div class="workflow-arrow">↓</div>
                                <div class="workflow-ministep">
                                    <img src="assets/icons/Approved.svg" width="20" height="20">
                                    <span>Update: Approved</span>
                                </div>
                                <div class="workflow-arrow">↓</div>
                                <div class="workflow-ministep">
                                    <img src="assets/icons/Email.svg" width="20" height="20">
                                    <span>Send Email</span>
                                </div>
                            </div>
                            <div class="subbranch">
                                <div class="subbranch-label">REJECTED</div>
                                <div class="workflow-arrow">↓</div>
                                <div class="workflow-ministep">
                                    <img src="assets/icons/Error.svg" width="20" height="20">
                                    <span>Update: Rejected</span>
                                </div>
                                <div class="workflow-arrow">↓</div>
                                <div class="workflow-ministep">
                                    <img src="assets/icons/Email.svg" width="20" height="20">
                                    <span>Send Email</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="branch branch-auto">
                        <div class="branch-label">NO APPROVAL NEEDED</div>
                        <div class="workflow-arrow">↓</div>
                        <div class="workflow-step">
                            <div class="step-icon"><img src="assets/icons/Approved.svg" width="28" height="28"></div>
                            <div class="step-content">
                                <h3>Auto-Accept</h3>
                                <p>Under threshold</p>
                            </div>
                        </div>
                        <div class="workflow-arrow">↓</div>
                        <div class="workflow-step">
                            <div class="step-icon"><img src="assets/icons/Email.svg" width="28" height="28"></div>
                            <div class="step-content">
                                <h3>Send Notification</h3>
                                <p>Email confirmation</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="steps" class="section steps-section">
        <div class="container">
            <h2>Build Instructions</h2>
            <p class="section-subtitle">Follow these 8 steps to build your complete approval workflow</p>

            <div class="steps-layout">
                <!-- Screenshot Sidebar -->
                <aside id="screenshotSidebar" class="screenshot-sidebar">
                    <div class="sidebar-header">
                        <h3>Screenshots of this Step</h3>
                        <p>Click to enlarge</p>
                    </div>
                    <div class="sidebar-carousel">
                        <div class="sidebar-carousel-track" id="sidebarCarouselTrack">
                            <!-- Slides will be injected by JavaScript -->
                        </div>
                        <button class="sidebar-carousel-btn prev" onclick="moveSidebarCarousel(-1)" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 18l-6-6 6-6"/>
                            </svg>
                        </button>
                        <button class="sidebar-carousel-btn next" onclick="moveSidebarCarousel(1)" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18l6-6-6-6"/>
                            </svg>
                        </button>
                        <div class="sidebar-indicators" id="sidebarIndicators">
                            <!-- Indicators will be injected by JavaScript -->
                        </div>
                    </div>
                </aside>

                <!-- Main Steps Content -->
                <div class="steps-content">

            <!-- Part 1 -->
            <div class="step-part" id="part-1">
                <div class="part-header">
                    <span class="part-number">01</span>
                    <div class="part-title">
                        <h3>Create New Flow</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 5 minutes</span>
                    </div>
                </div>

                <div class="substep">
                    <h4>Step 1.1: Navigate to Power Automate</h4>
                    <ol>
                        <li>Go to <a href="https://make.powerautomate.com" target="_blank">make.powerautomate.com</a></li>
                        <li>Click <strong>"Create"</strong> in left sidebar</li>
                        <li>Select <strong>"Automated cloud flow"</strong></li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 1.2: Configure Trigger</h4>
                    <ol>
                        <li><strong>Flow name:</strong> <code>RMC Rebate Approval System - [YOUR_NAME]</code></li>
                        <li><strong>Trigger:</strong> Search for "SharePoint"</li>
                        <li>Select <strong>"When an item is created"</strong></li>
                        <li>Click <strong>"Create"</strong></li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 1.3: Set up Trigger</h4>
                    <ul>
                        <li><strong>Site Address:</strong> [Select your SharePoint site]</li>
                        <li><strong>List Name:</strong> <code>COE_Academy_PA_Workshop</code></li>
                        <li>Click <strong>"New step"</strong></li>
                    </ul>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> Trigger shows "When an item is created" with correct SharePoint list
                </div>
            </div>

            <!-- Part 2 -->
            <div class="step-part" id="part-2">
                <div class="part-header">
                    <span class="part-number">02</span>
                    <div class="part-title">
                        <h3>Initialize Variables</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 10 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Why Variables?</strong>
                    <p>Variables store data we'll use multiple times in the flow. This avoids repeating complex expressions.</p>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Variable Types Explained:</strong>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                        <li><strong>Float:</strong> For decimal numbers (e.g., 7500.50, 3000.00) - Perfect for currency!</li>
                        <li><strong>String:</strong> For text (names, emails, IDs)</li>
                        <li><strong>Integer:</strong> For whole numbers only (1, 2, 100)</li>
                        <li><strong>Boolean:</strong> For true/false values</li>
                    </ul>
                </div>

                <div class="substep">
                    <h4>Step 2.1: Initialize Rebate Amount</h4>
                    <ol>
                        <li>Search for <strong>"Initialize variable"</strong></li>
                        <li>Click on action</li>
                        <li>Configure:
                            <ul>
                                <li><strong>Name:</strong> <code>varRebateAmount</code></li>
                                <li><strong>Type:</strong> Float <em>(we use Float because rebate amounts can have decimals like €7,500.50)</em></li>
                                <li><strong>Value:</strong> Click in field → Select <strong>"Rebate Amount"</strong> from Dynamic Content picker</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 2.2: Initialize Partner Name</h4>
                    <ol>
                        <li>Click <strong>"New step"</strong></li>
                        <li>Search for <strong>"Initialize variable"</strong></li>
                        <li>Configure:
                            <ul>
                                <li><strong>Name:</strong> <code>varPartnerName</code></li>
                                <li><strong>Type:</strong> String</li>
                                <li><strong>Value:</strong> Click in field → Select <strong>"Partner Name"</strong> from Dynamic Content picker</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 2.3: Initialize Analyst Email</h4>
                    <ol>
                        <li>Click <strong>"New step"</strong></li>
                        <li>Search for <strong>"Initialize variable"</strong></li>
                        <li>Configure:
                            <ul>
                                <li><strong>Name:</strong> <code>varAnalystEmail</code></li>
                                <li><strong>Type:</strong> String</li>
                                <li><strong>Value:</strong> Click in field → Select <strong>"Analyst Email"</strong> from Dynamic Content picker</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="warning-box">
                    <strong><img src="assets/icons/Warning.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> IMPORTANT:</strong> Use the Dynamic Content picker (lightning bolt icon), NOT manual typing!
                </div>

                <div class="substep">
                    <h4>Step 2.4: Initialize Request ID</h4>
                    <ol>
                        <li>Click <strong>"New step"</strong></li>
                        <li>Search for <strong>"Initialize variable"</strong></li>
                        <li>Configure:
                            <ul>
                                <li><strong>Name:</strong> <code>varRequestID</code></li>
                                <li><strong>Type:</strong> String</li>
                                <li><strong>Value:</strong> Click in field → Select <strong>"Rebate Request ID"</strong> from Dynamic Content picker</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> You should have 4 "Initialize variable" actions in sequence
                </div>
            </div>

            <!-- Part 3 -->
            <div class="step-part" id="part-3">
                <div class="part-header">
                    <span class="part-number">03</span>
                    <div class="part-title">
                        <h3>Add Condition (Approval Logic)</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 5 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> What's a Condition?</strong>
                    <p>Conditions create IF/THEN logic - if rebate amount is greater than €5,000, we need approval. Otherwise, auto-accept.</p>
                </div>

                <div class="substep">
                    <h4>Step 3.1: Add Condition Action</h4>
                    <ol>
                        <li>Click <strong>"New step"</strong></li>
                        <li>Search for <strong>"Condition"</strong></li>
                        <li>Click on the <strong>"Condition"</strong> action (Control connector)</li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 3.2: Configure Condition</h4>
                    <ol>
                        <li>Click in the first field (left side)</li>
                        <li>From Dynamic Content, select <strong>varRebateAmount</strong></li>
                        <li>Middle dropdown: select <strong>"is greater than"</strong></li>
                        <li>Right field: type <code>5000</code></li>
                    </ol>
                    <p style="margin-top: 12px;"><strong>Result:</strong> <code>varRebateAmount is greater than 5000</code></p>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> Condition shows two branches: "True" and "False"
                </div>
            </div>

            <!-- Part 4 -->
            <div class="step-part" id="part-4">
                <div class="part-header">
                    <span class="part-number">04</span>
                    <div class="part-title">
                        <h3>Start Approval Process</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 8 minutes</span>
                    </div>
                </div>

                <div class="warning-box">
                    <strong><img src="assets/icons/Warning.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> IMPORTANT:</strong> This action goes INSIDE the "If yes" branch (when approval is required)
                </div>

                <div class="substep">
                    <h4>Step 4.1: Add Approval Action</h4>
                    <ol>
                        <li>Inside the <strong>"If yes"</strong> branch, click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Start and wait for an approval"</strong></li>
                        <li>Select <strong>"Start and wait for an approval"</strong> action (Approvals connector)</li>
                    </ol>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Note:</strong>
                    <p>When you select the "Start and wait for an approval" action, you'll first see a button that says <strong>"Create new"</strong>. Click it to proceed with configuration.</p>
                </div>

                <div class="substep">
                    <h4>Step 4.2: Configure Approval</h4>
                    <ol>
                        <li><strong>Approval type:</strong> Select <strong>"Approve/Reject - First to respond"</strong></li>
                        <li><strong>Title:</strong> Type <code>Rebate Approval Required</code></li>
                        <li><strong>Assigned to:</strong> Click field → Select <strong>varAnalystEmail</strong> from Dynamic Content</li>
                        <li><strong>Details:</strong> Copy and paste this text:
                            <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px; font-size: 13px;">Partner: @{variables('varPartnerName')}
Amount: €@{variables('varRebateAmount')}
Request ID: @{variables('varRequestID')}

Please review and approve or reject this rebate request.</pre>
                        </li>
                    </ol>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Pro Tip:</strong>
                    <p>The approval will pause the flow until someone clicks "Approve" or "Reject" in the email they receive.</p>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> Approval action configured with dynamic content for Partner, Amount, and Request ID
                </div>
            </div>

            <!-- Part 5 -->
            <div class="step-part" id="part-5">
                <div class="part-header">
                    <span class="part-number">05</span>
                    <div class="part-title">
                        <h3>Check Approval Response</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 5 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Nested Conditions:</strong>
                    <p>We need another condition INSIDE the "If yes" branch to check if the approval was Approved or Rejected.</p>
                </div>

                <div class="substep">
                    <h4>Step 5.1: Add Second Condition</h4>
                    <ol>
                        <li>Below the approval action (still inside "If yes"), click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Condition"</strong></li>
                        <li>Click on the <strong>"Condition"</strong> action</li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 5.2: Configure Response Check</h4>
                    <ol>
                        <li>Click in the first field (left side)</li>
                        <li>From Dynamic Content, select <strong>"Outcome"</strong> (from the approval action)</li>
                        <li>Middle dropdown: select <strong>"is equal to"</strong></li>
                        <li>Right field: type <code>Approve</code> (case-sensitive!)</li>
                    </ol>
                    <p style="margin-top: 12px;"><strong>Result:</strong> <code>Outcome is equal to Approve</code></p>
                </div>

                <div class="warning-box">
                    <strong><img src="assets/icons/Warning.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> CASE SENSITIVE:</strong> Make sure you type "Approve" with capital A, NOT "approve"
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> You now have 2 conditions - one for amount threshold, one nested for approval outcome
                </div>
            </div>

            <!-- Part 6 -->
            <div class="step-part" id="part-6">
                <div class="part-header">
                    <span class="part-number">06</span>
                    <div class="part-title">
                        <h3>Update SharePoint Item</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 10 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Three Scenarios:</strong>
                    <p>We need to update the SharePoint item with the correct status in 3 different branches.</p>
                </div>

                <div class="substep">
                    <h4>Step 6.1: Update When Approved</h4>
                    <p><strong>Location:</strong> Inside nested condition → "If yes" branch (Outcome = Approve)</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Update item"</strong> (SharePoint)</li>
                        <li>Configure:
                            <ul>
                                <li><strong>Site Address:</strong> Select your SharePoint site</li>
                                <li><strong>List Name:</strong> <code>COE_Academy_PA_Workshop</code></li>
                                <li><strong>Id:</strong> Select <strong>"ID"</strong> from Dynamic Content (from trigger)</li>
                                <li><strong>Status Value:</strong> Click <strong>"Show advanced options"</strong> → Find <strong>"Status Value"</strong> → Type <code>Approved</code></li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 6.2: Update When Rejected</h4>
                    <p><strong>Location:</strong> Inside nested condition → "If no" branch (Outcome ≠ Approve)</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Update item"</strong> (SharePoint)</li>
                        <li>Configure same as above, but:
                            <ul>
                                <li><strong>Status Value:</strong> Click <strong>"Show advanced options"</strong> → Find <strong>"Status Value"</strong> → Type <code>Rejected</code></li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 6.3: Update When Auto-Accepted</h4>
                    <p><strong>Location:</strong> Inside first condition → "If no" branch (Amount ≤ 5000)</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Update item"</strong> (SharePoint)</li>
                        <li>Configure same as above, but:
                            <ul>
                                <li><strong>Status Value:</strong> Click <strong>"Show advanced options"</strong> → Find <strong>"Status Value"</strong> → Type <code>Approved</code></li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> You should have 3 "Update item" actions in different branches with different statuses
                </div>
            </div>

            <!-- Part 7 -->
            <div class="step-part" id="part-7">
                <div class="part-header">
                    <span class="part-number">07</span>
                    <div class="part-title">
                        <h3>Send Email Notifications</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 12 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Email for Each Branch:</strong>
                    <p>We'll send a confirmation email in each branch with different content based on the outcome.</p>
                </div>

                <div class="substep">
                    <h4>Step 7.1: Email When Approved</h4>
                    <p><strong>Location:</strong> After "Update item" in Approved branch</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Send an email (V2)"</strong> (Office 365 Outlook)</li>
                        <li>Configure:
                            <ul>
                                <li><strong>To:</strong> Select <strong>varAnalystEmail</strong></li>
                                <li><strong>Subject:</strong> <code>✅ Rebate Approved - @{variables('varPartnerName')}</code></li>
                                <li><strong>Body:</strong>
                                    <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px; font-size: 13px;">The rebate request has been APPROVED.

Partner: @{variables('varPartnerName')}
Amount: €@{variables('varRebateAmount')}
Request ID: @{variables('varRequestID')}
Status: Approved

Thank you!</pre>
                                </li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 7.2: Email When Rejected</h4>
                    <p><strong>Location:</strong> After "Update item" in Rejected branch</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Send an email (V2)"</strong></li>
                        <li>Configure:
                            <ul>
                                <li><strong>To:</strong> Select <strong>varAnalystEmail</strong></li>
                                <li><strong>Subject:</strong> <code>❌ Rebate Rejected - @{variables('varPartnerName')}</code></li>
                                <li><strong>Body:</strong>
                                    <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px; font-size: 13px;">The rebate request has been REJECTED.

Partner: @{variables('varPartnerName')}
Amount: €@{variables('varRebateAmount')}
Request ID: @{variables('varRequestID')}
Status: Rejected

Thank you!</pre>
                                </li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 7.3: Email When Auto-Accepted</h4>
                    <p><strong>Location:</strong> After "Update item" in Auto-Accept branch</p>
                    <ol>
                        <li>Click <strong>"Add an action"</strong></li>
                        <li>Search for <strong>"Send an email (V2)"</strong></li>
                        <li>Configure:
                            <ul>
                                <li><strong>To:</strong> Select <strong>varAnalystEmail</strong></li>
                                <li><strong>Subject:</strong> <code>✅ Rebate Auto-Accepted - @{variables('varPartnerName')}</code></li>
                                <li><strong>Body:</strong>
                                    <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px; font-size: 13px;">The rebate request has been AUTO-ACCEPTED (under €5,000 threshold).

Partner: @{variables('varPartnerName')}
Amount: €@{variables('varRebateAmount')}
Request ID: @{variables('varRequestID')}
Status: Auto-Accepted

No approval required.</pre>
                                </li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="checkpoint">
                    <strong><img src="assets/icons/Approved.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Checkpoint:</strong> You should have 3 "Send an email" actions with different subjects and content
                </div>
            </div>

            <!-- Part 8 -->
            <div class="step-part" id="part-8">
                <div class="part-header">
                    <span class="part-number">08</span>
                    <div class="part-title">
                        <h3>Test and Fix the Flow</h3>
                        <span class="part-duration"><img src="assets/icons/Clock.svg" width="14" height="14" style="vertical-align: middle; margin-right: 4px;"> 15 minutes</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Testing is Critical:</strong>
                    <p>Always test your flow before deploying to production. We'll encounter and fix common errors, then test all 3 scenarios.</p>
                </div>

                <div class="substep">
                    <h4>Step 8.1: Save the Flow</h4>
                    <ol>
                        <li>Click <strong>"Save"</strong> button (top right)</li>
                        <li>Wait for "Your flow is ready to go" message</li>
                        <li>Click <strong>"Test"</strong> button</li>
                        <li>Select <strong>"Manually"</strong></li>
                        <li>Click <strong>"Test"</strong></li>
                    </ol>
                </div>

                <div class="info-box">
                    <strong><img src="assets/icons/Light Bulb.svg" width="18" height="18" style="vertical-align: middle; margin-right: 4px;"> Test Data Ready:</strong>
                    <p>Use the data below - just copy and paste to save time!</p>
                </div>

                <div class="substep">
                    <h4>Step 8.2: Test Scenario 1 - Approval Required</h4>
                    <ol>
                        <li>Go to SharePoint list: <a href="https://amadeusworkplace.sharepoint.com/sites/CornerOfExcellence/Lists/COE_Academy_PA_Workshop/AllItems.aspx" target="_blank">COE_Academy_PA_Workshop</a></li>
                        <li>Click <strong>"+ New"</strong></li>
                        <li>Fill in (copy and paste these values):
                            <div style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px;">
                                <ul style="list-style: none; padding: 0;">
                                    <li><strong>Rebate Request ID:</strong> <code>REQ-001</code></li>
                                    <li><strong>Partner Name:</strong> <code>Amadeus Test Partner</code></li>
                                    <li><strong>Rebate Amount:</strong> <code>7500</code> (triggers approval)</li>
                                    <li><strong>Analyst Email:</strong> <code>[YOUR_EMAIL@amadeus.com]</code></li>
                                </ul>
                            </div>
                        </li>
                        <li>Click <strong>"Save"</strong></li>
                        <li>Check your email for approval request</li>
                        <li>Click <strong>"Approve"</strong> or <strong>"Reject"</strong></li>
                        <li>Verify status updated in SharePoint</li>
                        <li>Verify confirmation email received</li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 8.3: Test Scenario 2 - Auto-Accept</h4>
                    <ol>
                        <li>Create another item in SharePoint</li>
                        <li>Fill in (copy and paste these values):
                            <div style="background: #f5f5f5; padding: 12px; border-radius: 4px; margin-top: 8px;">
                                <ul style="list-style: none; padding: 0;">
                                    <li><strong>Rebate Request ID:</strong> <code>REQ-002</code></li>
                                    <li><strong>Partner Name:</strong> <code>Small Partner Test</code></li>
                                    <li><strong>Rebate Amount:</strong> <code>3000</code> (under threshold)</li>
                                    <li><strong>Analyst Email:</strong> <code>[YOUR_EMAIL@amadeus.com]</code></li>
                                </ul>
                            </div>
                        </li>
                        <li>Flow should auto-accept without approval</li>
                        <li>Verify status = "Approved" (auto-accepted)</li>
                        <li>Verify auto-accept email received</li>
                    </ol>
                </div>

                <div class="substep">
                    <h4>Step 8.4: Check Run History</h4>
                    <ol>
                        <li>In Power Automate, go to <strong>"My flows"</strong></li>
                        <li>Click on your flow name</li>
                        <li>Click <strong>"Run history"</strong> tab</li>
                        <li>Click on a run to see detailed execution</li>
                        <li>Check each action - all should have green checkmarks ✓</li>
                    </ol>
                </div>
            </div>

                </div><!-- End steps-content -->
            </div><!-- End steps-layout -->
        </div>
    </section>

    <!-- Outstanding Work Celebration Section -->
    <section class="section celebration-section">
        <div class="container">
            <div class="celebration-container" id="celebrationContainer">
                <canvas id="confettiCanvas"></canvas>
                <div class="celebration-card">
                    <div class="celebration-icon-wrapper">
                        <div class="celebration-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                    </div>
                    <h2>Congratulations! You Did It!</h2>
                    <p>You've successfully built a complete approval workflow with Power Automate. Your flow handles conditional logic, approvals, and email notifications—ready for production!</p>
                </div>
            </div>
        </div>
    </section>


    <section class="section download-resources-section">
        <div class="container">
            <h2>Download Complete Solution</h2>

            <div class="download-card">
                <div class="download-content">
                    <p>This package includes the fully configured approval workflow with all actions, conditions, and email templates. Perfect for importing into your environment or using as a reference.</p>

                    <div class="download-actions">
                        <a href="assets/flows/RMC-Rebate-Approval-System.zip" class="btn btn-primary" download>
                            Download Flow Package
                        </a>
                        <a href="https://learn.microsoft.com/en-us/power-automate/export-import-flow-non-solution" target="_blank" class="btn btn-outline">
                            How to Import
                        </a>
                    </div>

                    <div class="download-note">
                        <img src="assets/icons/Warning.svg" width="16" height="16">
                        <span>After importing, remember to update SharePoint connections and email addresses to match your environment.</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Troubleshooting Section -->
    <section id="troubleshooting" class="section troubleshooting-modern">
        <div class="container">
            <h2>Troubleshooting</h2>
            <p class="section-subtitle">Quick solutions to common issues you might encounter</p>

            <div class="troubleshooting-grid">
                <div class="trouble-card">
                    <div class="trouble-icon error">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                    </div>
                    <h3>Variables Not Working</h3>
                    <p>If you see "Unable to process template" errors:</p>
                    <ul>
                        <li>Use the <strong>Dynamic Content picker</strong> (⚡ icon)</li>
                        <li>Never manually type field names</li>
                        <li>Wait for the panel to load completely</li>
                    </ul>
                </div>

                <div class="trouble-card">
                    <div class="trouble-icon warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <h3>Flow Not Starting</h3>
                    <p>Check these common causes:</p>
                    <ul>
                        <li>Flow must be <strong>turned ON</strong></li>
                        <li>Verify correct SharePoint list selected</li>
                        <li>Wait 1-2 minutes for trigger to fire</li>
                        <li>Check Run History for errors</li>
                    </ul>
                </div>

                <div class="trouble-card">
                    <div class="trouble-icon info">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <h3>SharePoint Encoding (_x0020_)</h3>
                    <p>This is <strong>normal</strong>! SharePoint encodes spaces:</p>
                    <ul>
                        <li><code>_x0020_</code> = space character</li>
                        <li>Dynamic Content handles it automatically</li>
                        <li>Don't try to "fix" these field names</li>
                    </ul>
                </div>

                <div class="trouble-card">
                    <div class="trouble-icon success">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <h3>No Emails Received</h3>
                    <p>Before panicking, check:</p>
                    <ul>
                        <li>Junk/Spam folder first</li>
                        <li>Focused/Other inbox tabs</li>
                        <li>Run History shows green ✓ for email action</li>
                        <li>Email address is correct in SharePoint</li>
                    </ul>
                </div>

                <div class="trouble-card">
                    <div class="trouble-icon error">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                    </div>
                    <h3>Approval Outcome is Null</h3>
                    <p>Fix approval response issues:</p>
                    <ul>
                        <li>Use "Approve/Reject - <strong>First to respond</strong>"</li>
                        <li>Condition must be <strong>after</strong> approval action</li>
                        <li>Compare with <code>Approve</code> (capital A)</li>
                        <li>Actually click the button, don't let it timeout</li>
                    </ul>
                </div>

                <div class="trouble-card">
                    <div class="trouble-icon warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </div>
                    <h3>SharePoint Links Not Working</h3>
                    <p>Links showing as objects?</p>
                    <ul>
                        <li>Use <code>triggerBody()?['Link']</code></li>
                        <li><strong>Don't</strong> add <code>.Value</code> at the end</li>
                        <li>Link field is already a string</li>
                    </ul>
                </div>
            </div>

            <div class="troubleshooting-cta">
                <p>Still stuck? We're here to help!</p>
                <div class="cta-buttons">
                    <a href="mailto:rmc.coe@amadeus.com" class="btn btn-outline">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        Contact CoE Team
                    </a>
                    <a href="https://engage.cloud.microsoft/main/org/amadeus.com/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiIyMTAyODY5NDQyNTYifQ" class="btn btn-outline" target="_blank">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Join Community
                    </a>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-main">
                <div class="footer-column">
                    <div class="footer-logo">
                        <img src="../img/coe_white_logo.png" alt="CoE" height="48">
                    </div>
                    <p class="footer-tagline">
                        CoE Academy Sessions: <br>
                        Microsoft Power Automate
                    </p>
                </div>

                <div class="footer-column">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="../#about">About This Course</a></li>
                        <li><a href="../#sessions">Workshop Sessions</a></li>
                        <li><a href="../#resources">Resources</a></li>
                        <li><a href="https://amadeusworkplace.sharepoint.com/sites/CornerOfExcellence/" target="_blank">Corner Of Excellence</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Sessions</h4>
                    <ul>
                        <li><a href="../session-1/">Session 1: Fundamentals</a></li>
                        <li><a href="../session-2/">Session 2: Approval Workflows</a></li>
                        <li><a href="https://amadeusworkplace.sharepoint.com/:u:/r/sites/CornerOfExcellence/SitePages/Innovation-Academy.aspx?csf=1&web=1&e=PT3Rvb" target="_blank">CoE Academy Docs</a></li>
                        <li><a href="#troubleshooting">Troubleshooting Guide</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="mailto:rmc.coe@amadeus.com">Contact CoE Team</a></li>
                        <li><a href="https://engage.cloud.microsoft/main/org/amadeus.com/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiIyMTAyODY5NDQyNTYifQ" target="_blank">Power Platform Community</a></li>
                        <li><a href="https://learn.microsoft.com/en-us/power-automate/" target="_blank">Microsoft Docs</a></li>
                        <li><a href="https://forms.office.com/e/thDZJCdetg" target="_blank">Share Your Feedback</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-divider"></div>

            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <span>&copy; 2025 Corner of Excellence | Service Management and Innovation</span>
                </div>
                <div class="footer-bottom-right">
                    <span>Licensed under MIT</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Image Lightbox Modal -->
    <div class="image-lightbox" id="imageLightbox">
        <div class="lightbox-overlay" onclick="closeLightbox()"></div>
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()" type="button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <img id="lightboxImage" src="" alt="">
            <div class="lightbox-caption" id="lightboxCaption"></div>
        </div>
    </div>

    <script src="../assets/js/main.js?v=5"></script>
    <script src="assets/cheatsheet.js?v=5"></script>
</body>
</html>